<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Booster Model</title>
    <style>
        body {
            background-color: #333;
            color: orange;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            display: flex;
            gap: 50px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        .booster {
            border: 2px solid orange;
            padding: 20px;
            min-width: 300px;
        }
        .comparison {
            border: 2px solid white;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
        }
        .rocket {
            width: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid orange;
        }
        .section {
            width: 50px;
            background-color: orange;
            border-bottom: 2px solid black;
        }
        input[type='range'] {
            width: 100px;
        }
        .results {
            margin-top: 20px;
            padding: 10px;
            border: 2px solid white;
            width: 100%;
            max-width: 800px;
        }
        .parameter-group {
            margin-bottom: 10px;
        }
        .parameter-group label {
            display: inline-block;
            width: 150px;
        }
        .parameter-group input {
            margin-right: 10px;
        }
        .stage-info {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        .stage-info div {
            text-align: center;
            padding: 5px;
        }
        .delta-v-comparison {
            font-size: 1.5em;
            margin: 10px 0;
        }
        .delta-v-values {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        .delta-v-value {
            padding: 5px 15px;
            border: 1px solid orange;
            border-radius: 5px;
        }
        .calculation-mode {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid orange;
            border-radius: 5px;
            display: inline-block;
        }
        .calculation-mode select {
            background-color: #333;
            color: orange;
            border: 1px solid orange;
            padding: 5px;
            margin-left: 10px;
        }
        .parameter-group.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="comparison">
        <h2>Rocket Booster Optimization</h2>
        <div class="delta-v-comparison">
            <p id="comparisonText">ΔV₃ = ΔVₚ</p>
            <div class="delta-v-values">
                <div class="delta-v-value">
                    <span>ΔV₃: </span>
                    <span id="deltaV3">0</span> m/s
                </div>
                <div class="delta-v-value">
                    <span>ΔVₚ: </span>
                    <span id="deltaVp">0</span> m/s
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="booster">
            <h2>Three Stage Booster</h2>
            <div class="parameter-group">
                <label>Stage 1 Length (m):</label>
                <input type="range" min="0" max="10" step="0.1" id="length1" oninput="updateInput('length1_val', this.value)">
                <input
                  type="number"
                  id="length1_val"
                  min="0"
                  max="10"
                  step="0.1"
                  value="3.33"
                  oninput="onLengthInput(1, this)"
                >
            </div>
            <div class="parameter-group">
                <label>Stage 2 Length (m):</label>
                <input type="range" min="0" max="10" step="0.1" id="length2" oninput="updateInput('length2_val', this.value)">
                <input
                  type="number"
                  id="length2_val"
                  min="0"
                  max="10"
                  step="0.1"
                  value="3.33"
                  oninput="onLengthInput(2, this)"
                >
            </div>
            <div class="parameter-group">
                <label>Stage 3 Length (m):</label>
                <input type="range" min="0" max="10" step="0.1" id="length3" oninput="updateInput('length3_val', this.value)">
                <input
                  type="number"
                  id="length3_val"
                  min="0"
                  max="10"
                  step="0.1"
                  value="3.33"
                  oninput="onLengthInput(3, this)"
                >
            </div>
        </div>
        
        <div class="booster">
            <h2>Pop Out Booster</h2>
            <div class="parameter-group">
                <label>Core Length (m):</label>
                <input type="range" min="0" max="10" step="0.1" id="length4" oninput="updateInput('length4_val', this.value)">
                <input
                  type="number"
                  id="length4_val"
                  min="0"
                  max="10"
                  step="0.1"
                  value="3.33"
                  oninput="onLengthInput(4, this)"
                >
            </div>
            <div class="parameter-group">
                <label>Booster 1 Length (m):</label>
                <input type="range" min="0" max="10" step="0.1" id="length5" oninput="updateInput('length5_val', this.value)">
                <input
                  type="number"
                  id="length5_val"
                  min="0"
                  max="10"
                  step="0.1"
                  value="3.33"
                  oninput="onLengthInput(5, this)"
                >
            </div>
            <div class="parameter-group">
                <label>Booster 2 Length (m):</label>
                <input type="range" min="0" max="10" step="0.1" id="length6" oninput="updateInput('length6_val', this.value)">
                <input
                  type="number"
                  id="length6_val"
                  min="0"
                  max="10"
                  step="0.1"
                  value="3.33"
                  oninput="onLengthInput(6, this)"
                >
            </div>
        </div>
    </div>

    <div class="results">
        <h3>Optimization Results</h3>
        <div id="resultsContent">
            <div class="stage-info">
                <div>
                    <h4>Three Stage Booster</h4>
                    <p>Total ΔV: <span id="totalDeltaV3">0</span> m/s</p>
                    <p>Stage 1 ΔV: <span id="stage1DeltaV">0</span> m/s</p>
                    <p>Stage 2 ΔV: <span id="stage2DeltaV">0</span> m/s</p>
                    <p>Stage 3 ΔV: <span id="stage3DeltaV">0</span> m/s</p>
                </div>
                <div>
                    <h4>Pop Out Booster</h4>
                    <p>Total ΔV: <span id="totalDeltaVp">0</span> m/s</p>
                    <p>Core ΔV: <span id="coreDeltaV">0</span> m/s</p>
                    <p>Booster 1 ΔV: <span id="booster1DeltaV">0</span> m/s</p>
                    <p>Booster 2 ΔV: <span id="booster2DeltaV">0</span> m/s</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Constants
        const specific_impulse = 250;  // seconds
        const g = 9.80665;  // m/s^2
        const v_eq = g * specific_impulse;
        const meters_to_inches = 39.3700787402;
        const kg_to_lbs = 2.20462;
        const payload = 250 * kg_to_lbs;  // in lbs

        // New helper for number‐inputs
        function onLengthInput(stageIndex, input) {
            let v = parseFloat(input.value);
            if (isNaN(v)) v = 0;
            v = Math.min(10, Math.max(0, v));
            input.value = v.toFixed(1);

            // sync slider
            const slider = document.getElementById(`length${stageIndex}`);
            if (slider) slider.value = v;

            // trigger optimization
            if (stageIndex <= 3) {
                debouncedOptimize('threeStage');
            } else {
                debouncedOptimize('popOut');
            }

            // force cursor to end
            const len = input.value.length;
            input.setSelectionRange(len, len);
            input.focus();
        }

        function calculate_three_stage(data) {
            // ... your existing calculate_three_stage code unchanged ...
            /* snip for brevity */
        }

        function calculate_pop_out(data) {
            // ... your existing calculate_pop_out code unchanged ...
            /* snip for brevity */
        }

        // Keep your debounce, updateInput, updateRocketVisualization,
        // updateComparison, optimize, and load‐event code exactly as before,
        // minus the old validateNumberInput() function.
        
        // Debounced optimization function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        const debouncedOptimize = debounce((type) => {
            optimize(type);
        }, 500);

        // (Rest of your script: updateInput, optimize, window.load, etc.)
    </script>
</body>
</html>
